---
import { getLatestRelease, findAssetUrl } from '../lib/release';

const release = await getLatestRelease();
const version = release.tag_name;
const assets = release.assets;

const platforms = [
  {
    name: 'macOS',
    arch: 'Apple Silicon',
    detail: 'M1 / M2 / M3 / M4',
    url: findAssetUrl(assets, 'aarch64-apple-darwin'),
    icon: 'apple',
  },
  {
    name: 'macOS',
    arch: 'Intel',
    detail: 'x86_64',
    url: findAssetUrl(assets, 'x86_64-apple-darwin'),
    icon: 'apple',
  },
  {
    name: 'Linux',
    arch: 'x86_64',
    detail: 'Most desktop PCs',
    url: findAssetUrl(assets, 'x86_64-unknown-linux'),
    icon: 'linux',
  },
  {
    name: 'Linux',
    arch: 'ARM',
    detail: 'aarch64',
    url: findAssetUrl(assets, 'aarch64-unknown-linux'),
    icon: 'linux',
  },
];

const sourceCode = `git clone https://github.com/viktorholk/arma3-mod-manager-console.git
cd arma3-mod-manager-console
cargo run --release`;
---

<section id="download">
  <div class="container fade-in">
    <div class="download-header">
      <span class="version-badge">v{version}</span>
      <h2><span class="accent">#</span> Download</h2>
      <p class="download-subtitle">Pick your platform, unzip, and run. No installer needed.</p>
    </div>

    <div class="download-grid">
      {platforms.map((p) => (
        <a href={p.url} class="download-card">
          <span class="platform-icon">
            {p.icon === 'apple' ? (
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"/><path d="M10 2c1 .5 2 2 2 5"/></svg>
            ) : (
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="11.5" r="3.5"/><path d="M12 2a2.5 2.5 0 0 0-2.5 2.5c0 1 .5 1.5 1 2L12 8l1.5-1.5c.5-.5 1-1 1-2A2.5 2.5 0 0 0 12 2Z"/><path d="M15.5 11.5c0 2-1.5 3.5-3.5 3.5s-3.5-1.5-3.5-3.5"/><path d="m5 15.5 1.5-1 2 2"/><path d="m19 15.5-1.5-1-2 2"/><path d="M6.5 21c1-1 2.5-3 2.5-5.5"/><path d="M17.5 21c-1-1-2.5-3-2.5-5.5"/><path d="M12 15v7"/></svg>
            )}
          </span>
          <span class="platform-name">{p.name}</span>
          <span class="platform-arch">{p.arch}</span>
          <span class="platform-detail">{p.detail}</span>
          <span class="download-action">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
            Download .zip
          </span>
        </a>
      ))}
    </div>

    <div class="download-steps">
      <h3>After downloading</h3>
      <ol class="steps-list">
        <li>
          <span class="step-num">1</span>
          <div>
            <strong>Unzip</strong> the downloaded file
          </div>
        </li>
        <li>
          <span class="step-num">2</span>
          <div>
            <strong>Open a terminal</strong> and navigate to the folder where you unzipped it
          </div>
        </li>
        <li>
          <span class="step-num">3</span>
          <div>
            <strong>Run</strong> the binary:
            <div class="code-wrapper code-block-inline">
              <div class="code-block">
                <pre>./arma3-mod-manager-console</pre>
              </div>
              <button class="copy-btn" aria-label="Copy to clipboard">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
              </button>
            </div>
          </div>
        </li>
        <li>
          <span class="step-num">4</span>
          <div>
            <strong>Follow the setup wizard</strong> &mdash; it will guide you through selecting your Arma 3 and Workshop directories on first run
          </div>
        </li>
      </ol>
      <p class="install-note">
        <strong>macOS users:</strong> You may need to allow the binary in System Settings &gt; Privacy &amp; Security after the first run.
      </p>
    </div>

    <details class="build-source">
      <summary>Prefer to build from source?</summary>
      <p>Requires <a href="https://www.rust-lang.org/tools/install">Rust</a> to be installed.</p>
      <div class="code-wrapper">
        <div class="code-block">
          <pre>{sourceCode}</pre>
        </div>
        <button class="copy-btn" aria-label="Copy to clipboard">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
        </button>
      </div>
    </details>
  </div>
</section>
